# LangGraph 模式映射与验收清单

## 1. 需求到模式映射

### A. 固定步骤流水线

- 适用：输入稳定、步骤稳定、基本无分支
- 模式：Prompt Chaining
- 关键实现：线性 `add_edge`
- 验收：每步产物完整；失败可定位到单节点

### B. 条件分流

- 适用：同一入口，按意图或条件路由到不同链路
- 模式：Routing
- 关键实现：`add_conditional_edges`
- 验收：覆盖正负样例；不存在未知分支

### C. 动态并行任务

- 适用：子任务数量运行时决定，且可并行处理
- 模式：Orchestrator-worker
- 关键实现：`Send` + reducer
- 验收：并发结果可聚合；顺序无关时结果稳定

### D. 反复改进产物

- 适用：草稿到终稿需要多轮评估与修正
- 模式：Evaluator-optimizer
- 关键实现：循环边 + 停止条件
- 验收：达到阈值停止；避免无限循环

### E. 工具驱动代理

- 适用：需要 LLM 决策下一步并调用工具
- 模式：Agent
- 关键实现：模型节点 + 工具节点 + 路由
- 验收：工具失败可恢复；决策路径可追踪

## 2. 状态设计检查

- 状态键是否最小化，避免冗余复制
- 并行写键是否显式定义 reducer
- 临时中间值是否可以迁移到局部变量
- 是否区分用户输入、模型输出、系统元数据

## 3. 节点设计检查

- 单节点只处理一个原子职责
- 节点入参和出参是否稳定且可测试
- 异常是否有明确的重试或回退策略
- 外部副作用是否具备幂等保障

## 4. 测试清单

- 路由测试：覆盖命中和未命中分支
- 功能测试：状态变化与关键输出断言
- 恢复测试：`interrupt` 后 `resume` 成功
- 稳定性测试：重复运行结果满足预期

## 5. 常见失败模式

- 路由函数返回不存在的节点名
- 并行聚合键缺少 reducer 导致状态冲突
- `interrupt` 放在不可重放副作用之后
- 节点输出键拼写不一致导致状态丢失
